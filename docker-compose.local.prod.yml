version: "2"

services:
    artemis:
        image: vromero/activemq-artemis:2.6.3-alpine
        volumes:
            - ./artemis/:/var/lib/artemis/etc-override/
        expose:
            - "61616"
        ports:
            - 8161:8161
            - 61616:61616
        environment:
            - ARTEMIS_USERNAME=angio_app
        env_file:
            - .artemis.env

    angio-backend:
        image: angio-backend:latest
        build:
            context: ./
            dockerfile: ./angio-backend/src/main/docker/Dockerfile
        ports:
            - 8000:8000
            - 80:8080
        volumes:
            - static-content:/opt/angio-backend/static
        tty: true
        depends_on:
            - db
            - artemis
        env_file:
            - .angio-backend.env
            - .db.env
            - .artemis.env

    analyse-executor:
        image: analyse-executor:latest
        build:
            context: ./
            dockerfile: ./analyse-executor/src/main/docker/Dockerfile
        volumes:
            - static-content:/opt/analyse-executor/static
        tty: true
        depends_on:
            - db
            - artemis
        env_file:
            - .db.env
            - .artemis.env
